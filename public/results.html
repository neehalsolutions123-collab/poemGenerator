<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Generated Poem</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Spinner styling */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #loadingMessage {
      font-size: 1.2em;
      color: #555;
      margin: 20px 0;
      text-align: center;
    }

    .back-btn {
      display: block;
      margin: 30px auto 10px auto;
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .back-btn:hover {
      background-color: #2c80b4;
    }
  </style>
</head>
<body>
  <h1 id="poemHeader">Your Poem</h1>
  <div class="poem-container">
    <div id="loadingMessage">
      <span class="spinner"></span>✨ Your poem is being created... please wait ✨
    </div>
    <div id="result" style="display:none;"></div>
  </div>

  <!-- Back to main page button -->
  <button class="back-btn" id="backBtn">⬅ Go to Main Page</button>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const resultContainer = document.getElementById('result');
      const loadingMessage = document.getElementById('loadingMessage');
      const responseData = localStorage.getItem('webhookResponse');
      const poemKeyword = localStorage.getItem('poemKeyword');

      // Update header with keyword
      const header = document.getElementById('poemHeader');
      if (poemKeyword) {
        header.innerText = `Your Poem on ${poemKeyword}`;
      }

      if (responseData) {
        try {
          const data = JSON.parse(responseData);

          loadingMessage.style.display = 'none';
          resultContainer.style.display = 'block';
          resultContainer.innerHTML = '';

          const imageItem = data.find(item => item.url);
          if (imageItem) {
            const poemImage = document.createElement('img');
            poemImage.src = imageItem.url;
            poemImage.alt = 'Generated Poem Image';
            poemImage.style.maxWidth = '100%';
            poemImage.style.marginBottom = '20px';
            resultContainer.appendChild(poemImage);
          }

          const textItem = data.find(item => item.output);
          if (textItem) {
            const poemText = document.createElement('pre');
            poemText.innerText = textItem.output;
            resultContainer.appendChild(poemText);
          }

        } catch (e) {
          console.error(e);
          loadingMessage.innerText = '⚠️ Error: Invalid data format from webhook.';
        }
      } else {
        loadingMessage.innerText = '⚠️ No poem data found.';
      }

      // Back button handler
      document.getElementById('backBtn').addEventListener('click', function() {
        // Clear saved data
        localStorage.removeItem('poemKeyword');
        localStorage.removeItem('webhookResponse');

        // Redirect to index page
        window.location.href = 'index.html';
      });
    });
  </script>
</body>
</html>
